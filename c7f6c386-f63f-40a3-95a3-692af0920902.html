<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>杂志起始页 - Zji</title>
  <link rel="stylesheet" href="github-markdown.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="atom-one-dark.min.css">

</head>
<body>
  <main>
    <article class="markdown-body">
      <h1 class="note-title">杂志起始页</h1>
      <section><h2 id="%E6%95%88%E6%9E%9C%E5%9B%BE">效果图</h2><p><img src="b02ddebb-0030-4bf4-9f4f-a84f991a39e5.png" alt="杂志起始页"></p>
<h2 id="%E8%AF%B4%E6%98%8E">说明</h2><p>按照自己的使用习惯和需求制作的，未特别考虑通用性，不过已经添加详细注释，可以按需修改</p>
<p>我的一些观点——<a href="69e00a36-89f3-46dd-b24e-d9e96aeeb860.html" title="自由度">自由度</a></p>
<h2 id="%E4%BB%A3%E7%A0%81">代码</h2><p>参见 <a href="1d9e680b-d849-46f5-92d4-bd35977bc733.html" title="Dataview">Dataview</a> 的使用方法。</p>
<p>我尽可能按功能拆分了模块，为得是便于大家按需选用，便于任意排序，也便于讲解注意事项。你也可以把自己选用的模块都放在一个代码块中。</p>
<h3 id="%E6%A0%B7%E5%BC%8F%E6%A8%A1%E5%9D%97">样式模块</h3><p>包含了所有模块的样式，如果用不上，可以删除对应代码，不过保留对性能影响不大。此模块不显示任何内容，建议和其他模块共用一个代码段，比较便于编辑。</p>
<pre class="hljs js" lang="js">/* ==== 样式模块 ==== */
/* 为当前容器添加类，便于限定样式仅局部生效 */
dv.container.classList.add(&#x27;Startpage-Main&#x27;)
/* 注入模块样式 */
dv.container.innerHTML = `
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">
  <span class="hljs-comment">/* ==== 全局样式 ==== */</span>
  <span class="hljs-comment">/* 容器宽度限定，容器居中 */</span>
  <span class="hljs-selector-class">.Startpage-Main</span>,
  <span class="hljs-selector-class">.list-group</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attr">--main-color</span>: <span class="hljs-number">#ACACAF</span>;
  }
  <span class="hljs-comment">/* ==== 标题模块 ==== */</span>
  <span class="hljs-comment">/* 标题文字样式 */</span>
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-tag">h1</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">4rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;
    <span class="hljs-attribute">font-family</span>: serif;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">text-align</span>: center;
  }
  <span class="hljs-comment">/* ==== 进度模块 ==== */</span>
  <span class="hljs-comment">/* 内容布局方案 */</span>
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-class">.progress-area</span> {
    <span class="hljs-attribute">display</span>: flex;
  }
  <span class="hljs-comment">/* 文本样式 */</span>
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-class">.progress-area</span> <span class="hljs-selector-class">.progress-text</span> {
    <span class="hljs-attribute">font-size</span>: .<span class="hljs-number">8rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">font-family</span>: monospace;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">1em</span>;
  }
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-class">.day-progress</span> <span class="hljs-selector-class">.progress-text</span> {
    <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0</span>;
  }
  <span class="hljs-comment">/* 左侧进度条（已度过） */</span>
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-class">.progress-area</span> <span class="hljs-selector-class">.progress-pass</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(.<span class="hljs-number">4rem</span> + <span class="hljs-number">2px</span>);
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">4px</span> double <span class="hljs-number">#ACACAF</span>;
  }
  <span class="hljs-comment">/* 右侧进度条（未度过） */</span>
  <span class="hljs-selector-class">.Startpage-Main</span> <span class="hljs-selector-class">.progress-area</span> <span class="hljs-selector-class">.progress-will</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(.<span class="hljs-number">4rem</span> + <span class="hljs-number">2px</span>);
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">4px</span> double <span class="hljs-built_in">rgba</span>(<span class="hljs-number">172</span>, <span class="hljs-number">172</span>, <span class="hljs-number">175</span>, .<span class="hljs-number">3</span>);
  }
  <span class="hljs-comment">/* ==== 笔记统计模块 ==== */</span>
  <span class="hljs-comment">/* 内容文字样式 */</span>
  <span class="hljs-selector-class">.NoteStatistics</span>{
    <span class="hljs-attribute">font-size</span>: .<span class="hljs-number">8rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">font-family</span>: monospace;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">text-align</span>: center;
  }
  <span class="hljs-comment">/* 当宽度不足，隐藏部分细节 */</span>
  <span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">600px</span>) {
    <span class="hljs-selector-class">.NoteStatistics</span> <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.hide-when-narrow</span> {
      <span class="hljs-attribute">display</span>: none;
    }
  }
  <span class="hljs-comment">/* ==== 海报模块 ==== */</span>
  <span class="hljs-comment">/* 图片容器 */</span>
  <span class="hljs-selector-class">.post-area</span> {
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">background-size</span>: cover;
    <span class="hljs-attribute">background-position</span>: center;
    <span class="hljs-comment">/* 亮度、对比度、灰度、 饱和度、深褐色 */</span>
    <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">brightness</span>(<span class="hljs-number">2</span>) <span class="hljs-built_in">contrast</span>(<span class="hljs-number">1.3</span>) <span class="hljs-built_in">grayscale</span>(.<span class="hljs-number">8</span>) <span class="hljs-built_in">saturate</span>(.<span class="hljs-number">6</span>) <span class="hljs-built_in">sepia</span>(.<span class="hljs-number">3</span>);
    <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">1rem</span>;
  }
  <span class="hljs-comment">/* 海报标题 */</span>
  <span class="hljs-selector-class">.post-area</span> <span class="hljs-selector-class">.post-title</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">2rem</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">2rem</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;
    <span class="hljs-attribute">font-style</span>: italic;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">6</span>);
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#DDDDE3</span>;
    backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);
  }
  <span class="hljs-comment">/* 标题段落（为了在窄屏幕下）正确的折行 */</span>
  <span class="hljs-selector-class">.post-area</span> <span class="hljs-selector-class">.post-title</span>&gt;<span class="hljs-selector-tag">span</span> {
    <span class="hljs-attribute">display</span>: inline-block;
  }
  <span class="hljs-comment">/* ==== 笔记列表模块 ==== */</span>
  <span class="hljs-comment">/* 内部整体容器，控制排列和上下边距 */</span>
  <span class="hljs-selector-class">.list-group</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-wrap</span>: wrap;
  }
  <span class="hljs-comment">/* 单个笔记列表模块 */</span>
  <span class="hljs-selector-class">.list-group</span> <span class="hljs-selector-class">.note-list</span> {
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">2rem</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">33.33%</span>;
  }
  <span class="hljs-comment">/* 窄屏下并排数量 */</span>
  <span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">799px</span>) {
    <span class="hljs-selector-class">.list-group</span> <span class="hljs-selector-class">.note-list</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;
    }
  }
  <span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">599px</span>) {
    <span class="hljs-selector-class">.list-group</span> <span class="hljs-selector-class">.note-list</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    }
  }
  <span class="hljs-comment">/* 链接颜色 */</span>
  <span class="hljs-selector-class">.list-group</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
  }
  <span class="hljs-comment">/* ==== 任务列表 ==== */</span>
  <span class="hljs-selector-tag">ul</span> &gt; <span class="hljs-selector-tag">li</span><span class="hljs-selector-class">.task-list-item</span><span class="hljs-selector-attr">[data-task=<span class="hljs-string">&quot;x&quot;</span>]</span>, <span class="hljs-selector-tag">ul</span> &gt; <span class="hljs-selector-tag">li</span><span class="hljs-selector-class">.task-list-item</span><span class="hljs-selector-attr">[data-task=<span class="hljs-string">&quot;X&quot;</span>]</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#CFCFCF</span>;
  }
  <span class="hljs-comment">/* ==== 笔记索引 ==== */</span>
  <span class="hljs-selector-class">.callout</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#ACACAF</span>;
  }
  <span class="hljs-selector-class">.callout-icon</span> <span class="hljs-selector-class">.svg-icon</span>,
  <span class="hljs-selector-class">.callout-title-inner</span>,
  <span class="hljs-selector-class">.callout-title-inner</span> <span class="hljs-selector-tag">a</span>,
  <span class="hljs-selector-class">.callout-content</span>,
  <span class="hljs-selector-class">.callout-content</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
  }
  <span class="hljs-selector-class">.callout-content</span> <span class="hljs-selector-tag">mark</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ACACAF</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">225</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);;
  }
  <span class="hljs-comment">/* 隐藏块之间的换行 */</span>
  <span class="hljs-selector-class">.cm-line</span> &gt; br {
    <span class="hljs-attribute">display</span>: none;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
`</pre><h3 id="%E6%A0%87%E9%A2%98%E6%A8%A1%E5%9D%97">标题模块</h3><pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 标题模块 ==== */</span>
<span class="hljs-comment">/* 内容任意修改，没有使用 dv.header 方法是为了可以添加自定义类 */</span>
dv.el(<span class="hljs-string">&#x27;h1&#x27;</span>, <span class="hljs-string">&#x27;Hello world!&#x27;</span>, {<span class="hljs-keyword">cls</span>: <span class="hljs-string">&#x27;Start-header&#x27;</span>})</pre><h3 id="%E5%B9%B4/%E6%97%A5%E8%BF%9B%E5%BA%A6%E6%A8%A1%E5%9D%97">年/日进度模块</h3><p>示例图中与笔记统计模块相结合，结合方式为先按显示顺序书写添加元素代码：</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 元素插入 ==== */</span>
<span class="hljs-comment">/* 创建内容容器 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">yearBar</span> = dv.<span class="hljs-title function_ invoke__">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {<span class="hljs-attr">cls</span>: [<span class="hljs-string">&#x27;progress-area&#x27;</span>, <span class="hljs-string">&#x27;year-progress&#x27;</span>]})
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NoteStatistics</span> = dv.<span class="hljs-title function_ invoke__">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {<span class="hljs-attr">cls</span>: <span class="hljs-string">&#x27;NoteStatistics&#x27;</span>})
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">dayBar</span>  = dv.<span class="hljs-title function_ invoke__">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {<span class="hljs-attr">cls</span>: [<span class="hljs-string">&#x27;progress-area&#x27;</span>, <span class="hljs-string">&#x27;day-progress&#x27;</span>]})</pre><p>之后再书写各部分功能代码，这样就可以控制显示顺序了。当然这些代码要写在同一个代码段中。</p>
<p>之所以这样处理，是因为年进度和日进度相似代码很多，且都需要定时更新，所以合并到一起了。不太推荐拆分开，不过如果你只需要一个，可以删除另一个的 相关代码。</p>
<p>接续上方代码：</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 进度模块 ==== */</span>
<span class="hljs-comment">/* 进度更新函数 */</span>
<span class="hljs-keyword">const</span> changeProgress = ()=&gt;{
  <span class="hljs-comment">/* 如果元素不存在则终止 */</span>
  <span class="hljs-keyword">if</span>(!yearBar || !dayBar) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">/* 获取时间信息 */</span>
  <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
  <span class="hljs-keyword">const</span> year = now.getFullYear()
  <span class="hljs-keyword">const</span> yearStart = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, <span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> yearEnd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
  <span class="hljs-comment">/* 计算年进度 */</span>
  <span class="hljs-keyword">const</span> yearProgress = (now-yearStart)/(yearEnd-yearStart)
  <span class="hljs-keyword">const</span> yearPass = (yearProgress).toFixed(<span class="hljs-number">2</span>)
  <span class="hljs-comment">/* 计算日进度 */</span>
  <span class="hljs-keyword">const</span> dayProgress = (now%<span class="hljs-number">864e</span>5-now.getTimezoneOffset()*<span class="hljs-number">6e</span>4)/<span class="hljs-number">864e</span>5
  <span class="hljs-keyword">const</span> dayPass = (dayProgress).toFixed(<span class="hljs-number">2</span>)
  <span class="hljs-comment">/* 生成代码 */</span>
  yearBar.innerHTML = `
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-text&quot;</span>&gt;Year: ${(yearProgress*<span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}% &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-pass&quot;</span> style=<span class="hljs-string">&quot;flex-grow: ${yearPass};&quot;</span>&gt;&lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-will&quot;</span> style=<span class="hljs-string">&quot;flex-grow: ${1-yearPass};&quot;</span>&gt;&lt;/div&gt;`
  dayBar.innerHTML = `
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-pass&quot;</span> style=<span class="hljs-string">&quot;flex-grow: ${dayPass};&quot;</span>&gt;&lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-will&quot;</span> style=<span class="hljs-string">&quot;flex-grow: ${1-dayPass};&quot;</span>&gt;&lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;progress-text&quot;</span>&gt;Day: ${(dayProgress*<span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}% &lt;/div&gt;`
  <span class="hljs-comment">/* 用以点击复制的分享文案 */</span>
  yearBar.dataset.content = `YearProgress: ${<span class="hljs-string">&#x27;&#x27;</span>.padEnd(<span class="hljs-built_in">Math</span>.round(yearProgress / <span class="hljs-number">0.05</span>), <span class="hljs-string">&#x27;▓&#x27;</span>)}${<span class="hljs-string">&#x27;&#x27;</span>.padEnd(<span class="hljs-built_in">Math</span>.round((<span class="hljs-number">1</span> - yearProgress) / <span class="hljs-number">0.05</span>), <span class="hljs-string">&#x27;░&#x27;</span>)} ${(yearProgress*<span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}%`
  <span class="hljs-comment">/* 定时进行下一次更新 */</span>
  <span class="hljs-built_in">setTimeout</span>(changeProgress, <span class="hljs-number">6e</span>4)
}
changeProgress()
<span class="hljs-comment">/* 年进度复制 */</span>
yearBar.onclick = ()=&gt;{
  navigator.clipboard.writeText(yearBar.dataset.content)
}</pre><p>点击年进度条可以复制如下格式的内容：<code>YearProgress: ▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░ 59.02%</code>，以便到处分享，制造焦虑。日进度条没有，我觉得用不上，如果你有需求，自行添加即可，简单模仿一下对应代码。</p>
<h3 id="%E7%AC%94%E8%AE%B0%E7%BB%9F%E8%AE%A1%E6%A8%A1%E5%9D%97">笔记统计模块</h3><p>如果按照上方所述，已经提前添加了元素，则下面代码中添加元素部分应当删除。注意：必须放在同一个代码段中，才可以使用前面定义的变量。</p>
<p>此部分是将所有笔记按照需求过滤并统计，然后存入对应变量，所以也是笔记列表模块的前置。这里使用了一个全局变量 <code>window.notes</code> 存储结果，以便复用。所以在笔记列表模块之后最好用 <code>delete window.notes</code> 消除影响。</p>
<p>笔记时间统计使用的是 FrontMatter 中的 <code>created</code> 和 <code>updated</code> 字段，我觉得这样比较准确，有不同需求可以自行修改。</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 笔记统计模块 ==== */</span>
<span class="hljs-comment">/* 创建笔记统计元素 */</span>
const NoteStatistics = dv.el(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {<span class="hljs-attr">cls</span>: <span class="hljs-string">&#x27;NoteStatistics&#x27;</span>})
<span class="hljs-comment">/** @type {number} 最近更新时间 */</span>
let newestTime = <span class="hljs-number">0</span>
<span class="hljs-comment">/** @type {number} 最早创建时间 */</span>
let oldestTime = <span class="hljs-built_in">Date</span>.<span class="hljs-built_in">now</span>()
<span class="hljs-comment">/* 笔记信息数组 */</span>
window.notes = []
<span class="hljs-comment">/* 遍历所有笔记 */</span>
const pages = dv.pages().<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span>{
  <span class="hljs-comment">/**
   * 判断文件类型和文件夹名称
   * 如果不是 md 后缀的不算笔记
   * 如果在 Resource 文件夹下的不算笔记
   * 这里用了正则，但是很简单，比如你可以把 Resource 换成任何顶层文件夹的名称
   */</span>
  <span class="hljs-keyword">if</span>(e.file.ext !== <span class="hljs-string">&#x27;md&#x27;</span> || <span class="hljs-regexp">/^(Resource|ZJI)/</span>.test(e.file.folder)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
  <span class="hljs-comment">/** @type {number} 如果有更早的创建时间则存储 */</span>
  const createdTime = +<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(e.file.frontmatter.created)
  <span class="hljs-comment">/** @type {number} 如果有更晚的创建时间则存储 */</span>
  const updatedTime = +<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(e.file.frontmatter.updated)
  <span class="hljs-keyword">if</span>(createdTime&lt;oldestTime) oldestTime = createdTime
  <span class="hljs-keyword">if</span>(updatedTime&gt;newestTime) newestTime = updatedTime
  <span class="hljs-comment">/* 摘取必要信息存入笔记数组 */</span>
  window.notes.<span class="hljs-built_in">push</span>({
    <span class="hljs-attr">name</span>: e.file.name,
    <span class="hljs-attr">link</span>: e.file.link,
    <span class="hljs-attr">tags</span>: e.file.tags,
    <span class="hljs-comment">/* 关于时间，优先使用 FrontMatter 中的特定字段，如不存在，则使用系统数据（不准确，可能因同步等因素而被设定为错误的值） */</span>
    created: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(e.file?.frontmatter?.created || e.file?.ctime?.ts),
    <span class="hljs-attr">updated</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(e.file?.frontmatter?.updated || e.file?.mtime?.ts)
  })
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
})
<span class="hljs-comment">/* 拼接代码输出 */</span>
NoteStatistics.innerHTML = <span class="hljs-string">`笔记&lt;span class=&quot;hide-when-narrow&quot;&gt;总数&lt;/span&gt;：<span class="hljs-subst">${pages.<span class="hljs-built_in">length</span>}</span> |`</span>
+<span class="hljs-string">`&lt;span class=&quot;hide-when-narrow&quot;&gt; 标签总数：<span class="hljs-subst">${dv.pages(<span class="hljs-string">&#x27;&#x27;</span>).file.etags.<span class="hljs-built_in">distinct</span>().<span class="hljs-built_in">length</span>}</span> |&lt;/span&gt;`</span>
+<span class="hljs-string">` 最早&lt;span class=&quot;hide-when-narrow&quot;&gt;笔记&lt;/span&gt;：<span class="hljs-subst">${Math.<span class="hljs-built_in">round</span>((<span class="hljs-built_in">Date</span>.<span class="hljs-built_in">now</span>()-oldestTime)/<span class="hljs-number">864e5</span>)}</span> 天前 |`</span>
+<span class="hljs-string">` 上次&lt;span class=&quot;hide-when-narrow&quot;&gt;更新&lt;/span&gt;：<span class="hljs-subst">${Math.<span class="hljs-built_in">round</span>((<span class="hljs-built_in">Date</span>.<span class="hljs-built_in">now</span>()-newestTime)/<span class="hljs-number">864e5</span>)}</span> 天前`</span></pre><h3 id="%E6%B5%B7%E6%8A%A5%E6%A8%A1%E5%9D%97">海报模块</h3><p>海报中日期并不会实时更新，应该也没啥必要。当前图片源是每日更新。图片增加了滤镜，更符合这种旧杂志的风格，可以在样式模块中自行调整。</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 海报模块 ==== */</span>
<span class="hljs-comment">/* 创建元素 */</span>
const topStory = dv.el(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {<span class="hljs-attr">cls</span>: <span class="hljs-string">&#x27;post-area&#x27;</span>})
<span class="hljs-comment">/* 获取星期几，觉得这里用英文好看一点 */</span>
const dayName = [<span class="hljs-string">&#x27;Sunday&#x27;</span>, <span class="hljs-string">&#x27;Monday&#x27;</span>, <span class="hljs-string">&#x27;Tuesday&#x27;</span>, <span class="hljs-string">&#x27;Wednesday&#x27;</span>, <span class="hljs-string">&#x27;Thursday&#x27;</span>, <span class="hljs-string">&#x27;Friday&#x27;</span>, <span class="hljs-string">&#x27;Saturday&#x27;</span>][<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getDay()]
<span class="hljs-comment">/* 生成代码 */</span>
<span class="hljs-comment">/* 随机图片地址按需更换，我也没找到什么好用的，当前源是每日更新 */</span>
topStory.style = <span class="hljs-string">`background-image: url(&#x27;https://api.dujin.org/bing/1366.php?spam=<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.<span class="hljs-built_in">now</span>()}</span>&#x27;);`</span>
topStory.innerHTML = <span class="hljs-string">`
  &lt;div class=&quot;post-title&quot;&gt;&lt;span&gt;<span class="hljs-subst">${dv.func.dateformat(dv.<span class="hljs-built_in">date</span>(<span class="hljs-string">&#x27;now&#x27;</span>), <span class="hljs-string">&#x27;yyyy-MM-dd&#x27;</span>)}</span>&lt;/span&gt;&amp;nbsp;&lt;span&gt;<span class="hljs-subst">${dayName}</span>&lt;/span&gt;&lt;/div&gt;
`</span></pre><h3 id="%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97">任务列表模块</h3><p>需要自行修改任务目录，或者将小括号留空（检索所有笔记）。具体任务标记请按照自己的需求进行修改。</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 任务列表模块 ==== */</span>
<span class="hljs-comment">/* 读取所有任务，限定目录可以减少查询，提高性能 */</span>
const allTasks = dv.pages(<span class="hljs-string">&#x27;&quot;Work&quot;&#x27;</span>).file.tasks
<span class="hljs-comment">/* 今日完成的任务 */</span>
const todayDone = allTasks.<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span>t.completed &amp;&amp; t.completion.ts===dv.<span class="hljs-built_in">date</span>(<span class="hljs-string">&#x27;today&#x27;</span>).ts)
<span class="hljs-comment">/**
 * 输出任务列表组
 *
 * @param {string} title 列表标题（目前未使用，当注释了）
 * @param {number} count 列表最大任务数量
 * @param {array} taskList 经过排序/过滤的任务
 */</span>
const TaskAddGroup = <span class="hljs-function">(<span class="hljs-params">title, <span class="hljs-built_in">count</span>, taskList</span>)=&gt;</span>{
  <span class="hljs-keyword">return</span> taskList.<span class="hljs-built_in">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">count</span>).<span class="hljs-built_in">map</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span><span class="hljs-string">`&gt; - [<span class="hljs-subst">${t.status}</span>] <span class="hljs-subst">${t.<span class="hljs-built_in">text</span>}</span> &lt;small&gt;-<span class="hljs-subst">${t.link}</span>&lt;/small&gt;\n`</span>).join(<span class="hljs-string">&#x27;&#x27;</span>)
}
<span class="hljs-comment">/* 创建代码变量 */</span>
let TaskCode = <span class="hljs-string">`&gt; [!example] Task List\n`</span>
<span class="hljs-comment">/* 待办事项 */</span>
TaskCode += TaskAddGroup(<span class="hljs-string">&#x27;Next&#x27;</span>,  <span class="hljs-number">5</span>, allTasks.<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span>t.status===<span class="hljs-string">&#x27;!&#x27;</span>))
TaskCode += TaskAddGroup(<span class="hljs-string">&#x27;Todo&#x27;</span>,  <span class="hljs-number">5</span>, allTasks.<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span>t.status===<span class="hljs-string">&#x27; &#x27;</span>))
TaskCode += TaskAddGroup(<span class="hljs-string">&#x27;Plan&#x27;</span>,  <span class="hljs-number">5</span>, allTasks.<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span>t.status===<span class="hljs-string">&#x27;&gt;&#x27;</span>))
TaskCode += TaskAddGroup(<span class="hljs-string">&#x27;Maybe&#x27;</span>,  <span class="hljs-number">5</span>, allTasks.<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span>=&gt;</span>t.status===<span class="hljs-string">&#x27;?&#x27;</span>))
TaskCode += todayDone.<span class="hljs-built_in">length</span> ? <span class="hljs-string">`&gt; ---\n`</span> : <span class="hljs-string">&#x27;&#x27;</span>
TaskCode += TaskAddGroup(<span class="hljs-string">&#x27;Done&#x27;</span>,  <span class="hljs-number">5</span>, todayDone)
dv.el(<span class="hljs-string">&#x27;div&#x27;</span>, TaskCode)</pre><h3 id="%E7%AC%94%E8%AE%B0%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97">笔记列表模块</h3><pre class="hljs js" lang="js"><span class="hljs-comment">/* ==== 笔记列表模块 ==== */</span>
<span class="hljs-comment">/* 创建元素 */</span>
const NoteList = dv<span class="hljs-selector-class">.el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, {cls: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;list-group&#x27;</span>, <span class="hljs-string">&#x27;note-groups&#x27;</span>]</span>})
<span class="hljs-comment">/**
 * 输出笔记列表组
 *
 * @param {string} title 列表标题
 * @param {number} count 笔记数量
 * @param {array} noteList 经过排序/过滤的笔记
 */</span>
const noteAddGroup = (title, count, noteList)=&gt;{
  <span class="hljs-comment">/* 拼接笔记列表代码 */</span>
  const listCode = noteList<span class="hljs-selector-class">.slice</span>(<span class="hljs-number">0</span>, count)<span class="hljs-selector-class">.map</span>(f=&gt;`&lt;li&gt;&lt;<span class="hljs-selector-tag">a</span> href=<span class="hljs-string">&quot;${f.link}&quot;</span>&gt;${f.name}&lt;/a&gt;&lt;/li&gt;`)<span class="hljs-selector-class">.join</span>(<span class="hljs-string">&#x27;&#x27;</span>)
  <span class="hljs-comment">/* 套用模板输出 */</span>
  return `
  &lt;<span class="hljs-selector-tag">div</span> class=<span class="hljs-string">&quot;note-list&quot;</span>&gt;
    &lt;h3&gt;${title}&lt;/h3&gt;
    &lt;ul&gt;
      ${listCode}
    &lt;/ul&gt;
  &lt;/div&gt;`
}
<span class="hljs-comment">/* 星标笔记（包含 #stared 标签） */</span>
NoteList<span class="hljs-selector-class">.innerHTML</span> += <span class="hljs-built_in">noteAddGroup</span>(<span class="hljs-string">&#x27;Started Notes&#x27;</span>,  <span class="hljs-number">5</span>, window<span class="hljs-selector-class">.notes</span><span class="hljs-selector-class">.filter</span>(n=&gt;n<span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.includes</span>(<span class="hljs-string">&#x27;#stared&#x27;</span>)))
<span class="hljs-comment">/* 最近更新 */</span>
NoteList<span class="hljs-selector-class">.innerHTML</span> += <span class="hljs-built_in">noteAddGroup</span>(<span class="hljs-string">&#x27;Recent Changed&#x27;</span>, <span class="hljs-number">5</span>, window<span class="hljs-selector-class">.notes</span><span class="hljs-selector-class">.toSorted</span>((<span class="hljs-selector-tag">a</span>, b)=&gt; <span class="hljs-built_in">-</span>(<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.updated-b</span>.updated)))
<span class="hljs-comment">/* 最近创建 */</span>
NoteList<span class="hljs-selector-class">.innerHTML</span> += <span class="hljs-built_in">noteAddGroup</span>(<span class="hljs-string">&#x27;Recent Created&#x27;</span>, <span class="hljs-number">5</span>, window<span class="hljs-selector-class">.notes</span><span class="hljs-selector-class">.toSorted</span>((<span class="hljs-selector-tag">a</span>, b)=&gt; <span class="hljs-built_in">-</span>(<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.created-b</span>.created)))
<span class="hljs-comment">/* 删除全局变量 */</span>
delete window.notes</pre><h3 id="%E7%AC%94%E8%AE%B0%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97">笔记索引模块</h3><p>这部分比较简单，就是手写的 <a href="https://help.obsidian.md/Editing+and+formatting/Callouts" title="Callouts">Callouts</a>，其中有一些日期相关的内容，我用了 dataview 的 inline 查询：</p>
<pre class="hljs markdown" lang="markdown">&gt;[!note] Navs
&gt; `$= <span class="hljs-string">&#x27;[[Life/Logs/&#x27;</span>+dv.<span class="hljs-keyword">func</span>.dateformat(dv.<span class="hljs-keyword">func</span>.date(<span class="hljs-string">&#x27;today&#x27;</span>),  <span class="hljs-string">&#x27;yyyy-MM&#x27;</span>)+<span class="hljs-string">&#x27;|碎碎念]]&#x27;</span>` | `$= <span class="hljs-string">&#x27;[[Inbox/Idea/&#x27;</span>+dv.<span class="hljs-keyword">func</span>.dateformat(dv.<span class="hljs-keyword">func</span>.date(<span class="hljs-string">&#x27;today&#x27;</span>),  <span class="hljs-string">&#x27;yyyy-MM&#x27;</span>)+<span class="hljs-string">&#x27;|闪念胶囊]]&#x27;</span>`  | [Playground](Inbox/Playground)</pre><h3 id="%E6%9C%AA%E7%B4%A2%E5%BC%95%E7%AC%94%E8%AE%B0%E6%A8%A1%E5%9D%97">未索引笔记模块</h3><p>自行修改需排除的文件夹，索引文件（文件夹）位置，均为正则表达式。</p>
<pre class="hljs js" lang="js"><span class="hljs-comment">/* 创建代码 */</span>
const code = <span class="hljs-string">`&gt; [!danger] 未索引笔记
&gt; `</span>
+ dv.pages().<span class="hljs-built_in">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span>=&gt;</span>{
  <span class="hljs-comment">// 排除这些文件夹中的笔记</span>
  <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/^(ZJI|Resource|Life|Work|Inbox\/Idea)\//i</span>.test(p.file.path)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment">// 没有进入链接的文件</span>
  <span class="hljs-keyword">if</span>(!p.file?.inlinks?.<span class="hljs-built_in">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment">// 进入链接都不来自于索引文件（夹）</span>
  let unIndex = <span class="hljs-literal">true</span>
  p.file.inlinks.forEach(<span class="hljs-function"><span class="hljs-params">l</span>=&gt;</span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/^Start/i</span>.test(l.path)) unIndex = <span class="hljs-literal">false</span>
  })
  <span class="hljs-keyword">return</span> unIndex
}).<span class="hljs-built_in">map</span>(<span class="hljs-function"><span class="hljs-params">p</span>=&gt;</span>p.file.link).join(<span class="hljs-string">&#x27; | &#x27;</span>)
dv.el(<span class="hljs-string">&#x27;div&#x27;</span>, code)</pre></section>
    </article>
  </main>
  <aside>
    <div class="toggle"><i class="fa-solid fa-bars"></i></div>
    <div class="aside-content">
      <div class="nav">
        <ul>
          <li class="home"><a href="/"><i class="fa-solid fa-house"></i> Home</a></li>
          <li class="meow"><a href="https://afdian.net/a/daomishu" target="_blank"><i class="fa-solid fa-heart"></i> Meow~</a></li>
          <li class="gotop"><a href="#"><i class="fa-solid fa-plane-up"></i> Top</a></li>
        </ul>
      </div>
      <div class="toc"><ul><li data-hash="%E6%95%88%E6%9E%9C%E5%9B%BE" style="margin-left: 1.5em"><a href="#%E6%95%88%E6%9E%9C%E5%9B%BE">效果图</a></li>
<li data-hash="%E8%AF%B4%E6%98%8E" style="margin-left: 1.5em"><a href="#%E8%AF%B4%E6%98%8E">说明</a></li>
<li data-hash="%E4%BB%A3%E7%A0%81" style="margin-left: 1.5em"><a href="#%E4%BB%A3%E7%A0%81">代码</a></li>
<li data-hash="%E6%A0%B7%E5%BC%8F%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E6%A0%B7%E5%BC%8F%E6%A8%A1%E5%9D%97">样式模块</a></li>
<li data-hash="%E6%A0%87%E9%A2%98%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E6%A0%87%E9%A2%98%E6%A8%A1%E5%9D%97">标题模块</a></li>
<li data-hash="%E5%B9%B4/%E6%97%A5%E8%BF%9B%E5%BA%A6%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E5%B9%B4/%E6%97%A5%E8%BF%9B%E5%BA%A6%E6%A8%A1%E5%9D%97">年/日进度模块</a></li>
<li data-hash="%E7%AC%94%E8%AE%B0%E7%BB%9F%E8%AE%A1%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E7%AC%94%E8%AE%B0%E7%BB%9F%E8%AE%A1%E6%A8%A1%E5%9D%97">笔记统计模块</a></li>
<li data-hash="%E6%B5%B7%E6%8A%A5%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E6%B5%B7%E6%8A%A5%E6%A8%A1%E5%9D%97">海报模块</a></li>
<li data-hash="%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97">任务列表模块</a></li>
<li data-hash="%E7%AC%94%E8%AE%B0%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E7%AC%94%E8%AE%B0%E5%88%97%E8%A1%A8%E6%A8%A1%E5%9D%97">笔记列表模块</a></li>
<li data-hash="%E7%AC%94%E8%AE%B0%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E7%AC%94%E8%AE%B0%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97">笔记索引模块</a></li>
<li data-hash="%E6%9C%AA%E7%B4%A2%E5%BC%95%E7%AC%94%E8%AE%B0%E6%A8%A1%E5%9D%97" style="margin-left: 3em"><a href="#%E6%9C%AA%E7%B4%A2%E5%BC%95%E7%AC%94%E8%AE%B0%E6%A8%A1%E5%9D%97">未索引笔记模块</a></li></ul></div>
      <div class="meta"><small>created: 2023-08-04 14:30:54</small><br><small>updated: 2023-11-01 20:10:59</small></div>
    </div>
  </aside>
  <script src="script.js"></script>
  <script async
    src="https://state.zji.me/script.js"
    data-website-id="746d3aee-45c2-4dea-b72f-0cfb7891afe3"
    data-do-not-track="true"
    data-domains="zji.me"></script>
  <foot>©2022~2023 稻米鼠. Last build at 2023/11/15 15:29:11</foot>
</body>
</html>